
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>MongoDB With Jongo - Sleeves Up!</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="../../../../assets/built/screen.css?v=1e82d01aa7">
    <link rel="stylesheet" type="text/css" href="../../../../assets/css/prism.css?v=1e82d01aa7">

    <link rel="shortcut icon" href="../../../../favicon.png" type="image/png">
    <link rel="canonical" href="http://localhost:2368/2013/04/03/mongodb-with-jongo-sleeves-up/">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="amphtml" href="http://localhost:2368/2013/04/03/mongodb-with-jongo-sleeves-up/amp/">
    
    <meta property="og:site_name" content="ingini">
    <meta property="og:type" content="article">
    <meta property="og:title" content="MongoDB With Jongo - Sleeves Up!">
    <meta property="og:description" content="Abstract : In this post you will find a brief introduction to Jongo - a fast, easy-to-use, Java-based querying library for MongoDB. There are plenty of articles discussing MongoDB around the Internet and it’s documentation is quite good. Thus, here you won’t find any introduction to MongoDB nor am">
    <meta property="og:url" content="http://localhost:2368/2013/04/03/mongodb-with-jongo-sleeves-up/">
    <meta property="article:published_time" content="2013-04-03T08:00:00.000Z">
    <meta property="article:modified_time" content="2016-01-24T16:27:24.000Z">
    <meta property="article:tag" content="Java">
    <meta property="article:tag" content="Jongo">
    <meta property="article:tag" content="MongoDB">
    <meta property="article:tag" content="NoSQL">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="MongoDB With Jongo - Sleeves Up!">
    <meta name="twitter:description" content="Abstract : In this post you will find a brief introduction to Jongo - a fast, easy-to-use, Java-based querying library for MongoDB. There are plenty of articles discussing MongoDB around the Internet and it’s documentation is quite good. Thus, here you won’t find any introduction to MongoDB nor am">
    <meta name="twitter:url" content="http://localhost:2368/2013/04/03/mongodb-with-jongo-sleeves-up/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Ivan Hristov">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="Java, Jongo, MongoDB, NoSQL">
    <meta name="twitter:creator" content="@iv_hristov">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "ingini",
        "logo": {
            "@type": "ImageObject",
            "url": "http://localhost:2368/favicon.png",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "Ivan Hristov",
        "image": {
            "@type": "ImageObject",
            "url": "http://localhost:2368/content/images/2018/02/ivan_hristov_small.svg",
            "width": 100,
            "height": 100
        },
        "url": "http://localhost:2368/author/ivan/",
        "sameAs": [
            "https://twitter.com/iv_hristov"
        ]
    },
    "headline": "MongoDB With Jongo - Sleeves Up!",
    "url": "http://localhost:2368/2013/04/03/mongodb-with-jongo-sleeves-up/",
    "datePublished": "2013-04-03T08:00:00.000Z",
    "dateModified": "2016-01-24T16:27:24.000Z",
    "keywords": "Java, Jongo, MongoDB, NoSQL",
    "description": "Abstract : In this post you will find a brief introduction to Jongo - a fast, easy-to-use, Java-based querying library for MongoDB. There are plenty of articles discussing MongoDB around the Internet and it’s documentation is quite good. Thus, here you won’t find any introduction to MongoDB nor am",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:2368/"
    }
}
    </script>

    <script type="text/javascript" src="../../../../public/ghost-sdk.js?v=1e82d01aa7"></script>
<script type="text/javascript">
ghost.init({
	clientId: "ghost-frontend",
	clientSecret: "83aadd2aedf2"
});
</script>
    <meta name="generator" content="Ghost 1.21">
    <link rel="alternate" type="application/rss+xml" title="ingini" href="http://localhost:2368/rss/">
    <link href="../../../../assets/css/prism.css" rel="stylesheet">
<script type="text/javascript" src="../../../../assets/js/prism.js"></script>
<script>
var ga_id = 'UA-35925613-1';
var disqus_shortname = 'ihristov'
var social_link = {
    'linkedin': 'http://ch.linkedin.com/in/ivhristov',
    'github': 'https://github.com/ihr',
    'twitter': 'https://twitter.com/iv_hristov'
}
</script>

</head>
<body class="post-template tag-java tag-jongo tag-mongodb tag-nosql">

    <div class="site-wrapper">

        

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
                <a class="site-nav-logo" href="http://localhost:2368">ingini</a>
    </div>
    <div class="site-nav-right">
        <div class="social-links">
        </div>
            <a class="subscribe-button" href="index.html#subscribe">Subscribe</a>
    </div>
</nav>
    </div>
</header>


<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full post tag-java tag-jongo tag-mongodb tag-nosql no-image">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="2013-04-03">3 April 2013</time>
                        <span class="date-divider">/</span> <a href="../../../../tag/java/">Java</a>
                </section>
                <h1 class="post-full-title">MongoDB With Jongo - Sleeves Up!</h1>
            </header>


            <section class="post-full-content">
                <div class="kg-card-markdown"><p><strong>Abstract</strong> : In this post you will find a brief introduction to <a href="http://jongo.org/">Jongo</a> - a fast, easy-to-use, Java-based querying library for <a href="http://www.mongodb.org/">MongoDB</a>. There are plenty of articles discussing MongoDB around the Internet and <a href="http://docs.mongodb.org/manual/">it’s documentation</a> is quite good. Thus, here you won’t find any introduction to MongoDB nor am I going to convince you to use it or not. In this article I’m going to show you that querying MongoDB from Java can be easy. Don’t be afraid from the size of the post, most of it is simple code and data samples.</p>
<p><strong>Goal</strong> : Basic use of Jongo for querying MongoDB.</p>
<p><strong>Acknowledgement</strong> : My gratitude goes to the open source community and especially to:</p>
<p><a href="https://twitter.com/bguerout">Benoit Guérout</a> creator of Jongo</p>
<p><a href="https://twitter.com/amsellemyves">Yves Amsellem</a> co-creator of Jongo</p>
<p><a href="https://twitter.com/xbourguignon">Xavier Bourguignon</a> for his open-mind and open-heart</p>
<p><strong>Code</strong> : You can download the full source of the project from <a href="https://github.com/ihr/jongo-by-example">GitHub</a></p>
<p><strong>Prerequisite</strong></p>
<p>You’re going to need a MongoDB instance running on your local machine and on the default port, if you want to run the code on GitHub. Thus, first you need to download <a href="http://www.mongodb.org/downloads">MongoDB</a>. Once you’ve done that, you would have to unzip what you’ve downloaded and go to the bin folder and execute the mongod command … and you are ready to go. Just for information: next to the mongod there is an executable called mongo which is the MongoDB shell and will provide you with access to any MongoDB database.</p>
<p>Sleeves up!</p>
<p>Let’s get started. First our domain model: we are going to use <a href="http://en.wikipedia.org/wiki/A_Game_of_Thrones">Game of Thrones</a> as our starting point. For those of you who don’t know <em>Game of Thrones</em>, I can only say (… shame on you): get the books or the TV series (even better, get them both), relax and enjoy. In short, <em>Game of Thrones</em> is a series of fantasy novels by <a href="http://www.georgerrmartin.com/">George R. R. Martin</a>. And as in any novel there are some heroes and heroines. Now, I must warn you that there are some heroic creatures in <em>Game of Thrones</em> such as wolves and dragons but to keep the post simple, I’m going to leave there character modeling for later. Right now we are going to concentrate on humans:</p>
<pre><code class="language-language-java">package org.ingini.jongo.example.model;

import com.fasterxml.jackson.annotation.JsonProperty;
import com.fasterxml.jackson.annotation.JsonSubTypes;
import com.fasterxml.jackson.annotation.JsonTypeInfo;
import org.apache.commons.lang3.builder.EqualsBuilder;
import org.apache.commons.lang3.builder.HashCodeBuilder;

import java.util.Set;

import static com.fasterxml.jackson.annotation.JsonTypeInfo.As;
import static com.fasterxml.jackson.annotation.JsonTypeInfo.Id;

@JsonTypeInfo(use = Id.NAME, include = As.PROPERTY, property = Human.GENDER)
@JsonSubTypes({
        @JsonSubTypes.Type(value = Heroine.class, name = Gender.Constants.FEMALE_VALUE),
        @JsonSubTypes.Type(value = Hero.class, name = Gender.Constants.MALE_VALUE)
})
public abstract class Human {

    public static final String FIRST_NAME = "first_name";
    public static final String LAST_NAME = "last_name";
    public static final String GENDER = "gender";
    public static final String ADDRESS = "address";
    public static final String CHILDREN = "children";
    private final String firstName;
    private final String lastName;
    private final Gender gender;
    private final Address address;
    private final Set&lt;? extends Human&gt; children;

    protected Human(String firstName, String lastName, Gender gender, Address address, Set&lt;? extends Human&gt; children) {
        this.firstName = firstName;
        this.lastName = lastName;
        this.gender = gender;
        this.address = address;
        this.children = children;
    }

    @JsonProperty(FIRST_NAME)
    public String getFirstName() {
        return firstName;
    }

    @JsonProperty(LAST_NAME)
    public String getLastName() {
        return lastName;
    }

    @JsonProperty(GENDER)
    public Gender getGender() {
        return gender;
    }

    @JsonProperty(ADDRESS)
    public Address getAddress() {
        return address;
    }

    @JsonProperty(CHILDREN)
    public Set&lt;? extends Human&gt; getChildren() {
        return children;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;

        Human human = (Human) o;

        return new EqualsBuilder().append(this.firstName, human.firstName).append(this.lastName, human.lastName)
                .append(this.gender, human.gender).append(this.address, this.address).isEquals();
    }

    @Override
    public int hashCode() {
        return new HashCodeBuilder(7, 61).append(firstName).append(lastName).append(gender).append(address).toHashCode();
    }
}
</code></pre>
<p>For simplicity, we are going to consider that a human can be of a female or male gender:</p>
<pre><code class="language-java">
package org.ingini.jongo.example.model;

import static org.ingini.jongo.example.model.Gender.Constants.*;

public enum Gender {
    MALE(MALE_VALUE), FEMALE(FEMALE_VALUE);

    Gender(String genderString) {
    }


    public static class Constants {
        public static final String MALE_VALUE = "MALE";
        public static final String FEMALE_VALUE = "FEMALE";
    }
}
</code></pre>
<p>Thus we can have a human hierarchy based on gender:</p>
<pre><code class="language-java">package org.ingini.jongo.example.model;

import com.fasterxml.jackson.annotation.JsonCreator;
import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import com.fasterxml.jackson.annotation.JsonProperty;

import java.util.Set;

import static org.ingini.jongo.example.model.Gender.MALE;

@JsonIgnoreProperties(ignoreUnknown = true)
public class Hero extends Human {

    @JsonCreator
    public Hero(@JsonProperty(FIRST_NAME) String firstName,
                @JsonProperty(LAST_NAME) String lastName,
                @JsonProperty(ADDRESS) Address address,
                @JsonProperty(CHILDREN) Set&lt;Human&gt; children) {
        super(firstName, lastName, MALE, address, children);
    }

    public static Hero createHeroWithoutChildren(String firstName, String lastName, Address address) {
        return new Hero(firstName, lastName, address, null);
    }
}
</code></pre>
<p>… and a heroine:</p>
<pre><code class="language-java">package org.ingini.jongo.example.model;

import com.fasterxml.jackson.annotation.JsonCreator;
import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import com.fasterxml.jackson.annotation.JsonProperty;

import java.util.Set;

import static org.ingini.jongo.example.model.Gender.FEMALE;

@JsonIgnoreProperties(ignoreUnknown = true)
public class Heroine extends Human {

    @JsonCreator
    public Heroine(@JsonProperty(FIRST_NAME) String firstName,
                   @JsonProperty(LAST_NAME) String lastName,
                   @JsonProperty(ADDRESS) Address address,
                   @JsonProperty(CHILDREN) Set&lt;Human&gt; children) {
        super(firstName, lastName, FEMALE, address, children);
    }

    public static Heroine createHeroineWithoutChildren(String firstName, String lastName, Address address) {
        return new Heroine(firstName, lastName, address, null);
    }
}
</code></pre>
<p>As you can see from our Human class, every human has an address:</p>
<pre><code class="language-java">package org.ingini.jongo.example.model;

import com.fasterxml.jackson.annotation.JsonCreator;
import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import com.fasterxml.jackson.annotation.JsonProperty;
import org.apache.commons.lang3.builder.EqualsBuilder;
import org.apache.commons.lang3.builder.HashCodeBuilder;

@JsonIgnoreProperties(ignoreUnknown = true)
public class Address {

    public static final String CASTLE = "castle";
    public static final String CONTINENT = "continent";
    public static final String REGION = "region";

    private final String castle;
    private final String continent;
    private final Region region;

    @JsonCreator
    public Address(@JsonProperty(CASTLE) String castle,
      @JsonProperty(CONTINENT) String continent,
                  @JsonProperty(REGION) Region region) {
        this.castle = castle;
        this.continent = continent;
        this.region = region;
    }

    @JsonProperty(CASTLE)
    public String getCastle() {
        return castle;
    }

    @JsonProperty(CONTINENT)
    public String getContinent() {
        return continent;
    }

    @JsonProperty(REGION)
    public Region getRegion() {
        return region;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;

        Address address = (Address) o;

        return new EqualsBuilder()
                .append(this.castle, address.castle)
                .append(this.continent, address.continent)
                .append(this.region, this.region).isEquals();
    }

    @Override
    public int hashCode() {
        return new HashCodeBuilder(11, 43).append(castle).append(continent).append(region).toHashCode();
    }
}
</code></pre>
<p>The one thing left is the realm’s regions. In case you still don’t know what the realm’s regions are : go back to the novels (or TV series) or just click <a href="http://gameofthrones.wikia.com/wiki/Category:Regions">here</a>. I’ve used an enum to represent the regions but I’ve put only some of them:</p>
<pre><code class="language-java">
package org.ingini.jongo.example.model;

public enum Region {
    WESTEROS, ESSOS, DORNE, IRON_ISLANDS, THE_CROWNLANDS, THE_RIVERLANDS, THE_VALE_OF_ARRYN, THE_NORTH, THE_REACH
}
</code></pre>
<h1 id="crudthejongoway">CRUD - the Jongo way</h1>
<hr>
<h3 id="creatinginsertingsaving">Creating/Inserting/Saving</h3>
<p>Let’s start by creating a very important heroine called Arya Stark:</p>
<pre><code class="language-java">Jongo jongo = new Jongo(mongoDB);

MongoCollection heroes = jongo.getCollection("heroes");

Heroine aryaStark = Heroine.createHeroineWithoutChildren("Arya", "Stark", //
                new Address("Winterfell", "Westeros", Region.THE_NORTH));

heroes.insert(aryaStark);
</code></pre>
<p>… and here is the MongoDB document:</p>
<pre><code class="language-json">{
  "_id" : ObjectId("51865d8c21622e48542ea6ac"),
  "gender" : "FEMALE",
  "first_name" : "Arya",
  "last_name" : "Stark",
  "address" : {
      "castle" : "Winterfell",
      "continent" : "Westeros",
      "region" : "THE_NORTH"
  },
  "gender" : "FEMALE"
}
</code></pre>
<p>Let’s also create and insert the father of Arya Stark - <a href="http://gameofthrones.wikia.com/wiki/Eddard_Stark">Eddard Stark</a>:</p>
<pre><code class="language-java">
Jongo jongo = new Jongo(mongoDB);

MongoCollection heroes = jongo.getCollection("heroes");

Address castleWinterfell = new Address("Winterfell", "Westeros", Region.THE_NORTH);

Set&lt;Human&gt; children = Sets.newHashSet();
children.add(Hero.createHeroWithoutChildren("Robb", "Stark", castleWinterfell));
children.add(Heroine.createHeroineWithoutChildren("Sansa", "Stark", castleWinterfell));
children.add(Heroine.createHeroineWithoutChildren("Arya", "Stark", castleWinterfell));
children.add(Hero.createHeroWithoutChildren("Bran", "Stark", castleWinterfell));
children.add(Hero.createHeroWithoutChildren("Rickon", "Stark", castleWinterfell));
children.add(Hero.createHeroWithoutChildren("Jon", "Snow", castleWinterfell));

Hero eddardStark = new Hero("Eddard", "Stark", castleWinterfell, children);

heroes.insert(eddardStark);
</code></pre>
<p>What I’ve done is a good example of a composite, tree structure. I have a main node document (Eddard Stark) and his children/leaves (Robb, Sansa, Arya, Bran, Rickon, Jon). For those of you who are new to the world of MongoDB, I hope you can easily see the power you’ve been given:</p>
<pre><code class="language-json">{
        "_id": "5186a0da21622e48542ea6af",
        "gender": "MALE",
        "first_name": "Eddard",
        "last_name": "Stark",
        "address": {
            "castle": "Winterfell",
            "continent": "Westeros",
            "region": "THE_NORTH"
        },
        "children": [
            {
                "gender": "MALE",
                "first_name": "Bran",
                "last_name": "Stark",
                "address": {
                    "castle": "Winterfell",
                    "continent": "Westeros",
                    "region": "THE_NORTH"
                },
                "gender": "MALE"
            },
            {
                "gender": "FEMALE",
                "first_name": "Sansa",
                "last_name": "Stark",
                "address": {
                    "castle": "Winterfell",
                    "continent": "Westeros",
                    "region": "THE_NORTH"
                },
                "gender": "FEMALE"
            },
            {
                "gender": "MALE",
                "first_name": "Rickon",
                "last_name": "Stark",
                "address": {
                    "castle": "Winterfell",
                    "continent": "Westeros",
                    "region": "THE_NORTH"
                },
                "gender": "MALE"
            },
            {
                "gender": "FEMALE",
                "first_name": "Arya",
                "last_name": "Stark",
                "address": {
                    "castle": "Winterfell",
                    "continent": "Westeros",
                    "region": "THE_NORTH"
                },
                "gender": "FEMALE"
            },
            {
                "gender": "MALE",
                "first_name": "Jon",
                "last_name": "Snow",
                "address": {
                    "castle": "Winterfell",
                    "continent": "Westeros",
                    "region": "THE_NORTH"
                },
                "gender": "MALE"
            },
            {
                "gender": "MALE",
                "first_name": "Robb",
                "last_name": "Stark",
                "address": {
                    "castle": "Winterfell",
                    "continent": "Westeros",
                    "region": "THE_NORTH"
                },
                "gender": "MALE"
            }
        ],
        "gender": "MALE"
    }
</code></pre>
<p>Note that up to now I’ve used the automatically generated <em>_id</em> by MongoDB which are ‘most likely unique’ (according to the docs <a href="http://docs.mongodb.org/manual/reference/object-id/">ObjectId</a>). I invite you to take a look at the docs and see for yourself if you are happy with the ‘most likely unique’ statement (personally, I’m satisfied). Of course, in certain scenarios you may have a natural unique identifier or you might want to generate the <em>_id</em> manually. Either way, Jongo is here for you and gives you the means to do it. In order to show you how, I will create a new collection called weapons which will hold different weapons belonging to the heroes and heroines in <em>Game of Thrones</em>. Here is our sword class:</p>
<pre><code class="language-java">
package org.ingini.jongo.example.model.weapons;

import com.fasterxml.jackson.annotation.JsonCreator;
import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import com.fasterxml.jackson.annotation.JsonProperty;
import org.jongo.marshall.jackson.oid.Id;

@JsonIgnoreProperties(ignoreUnknown = true)
public class Sword {

    public static final String ID = "_id";
    public static final String MATERIAL = "material";

    @Id
    private final String _id;
    private final String material;

    @JsonCreator
    public Sword(@JsonProperty(ID) String _id, @JsonProperty(MATERIAL) String material) {
        this._id = _id;
        this.material = material;
    }

    @JsonProperty(ID)
    public String getId() {
        return _id;
    }

    @JsonProperty(MATERIAL)
    public String getMaterial() {
        return material;
    }
}
</code></pre>
<p>… and here is how you can create and insert one such document:</p>
<pre><code class="language-java">Jongo jongo = new Jongo(mongoDB);

MongoCollection weapons = jongo.getCollection("weapons");

Sword lightbringer = new Sword("Lightbringer", null);

weapons.save(lightbringer);
</code></pre>
<p>… and here is what the MongoDB document looks like after being inserted:</p>
<pre><code class="language-json">{ "_id" : "Lightbringer" }
</code></pre>
<p>Note however, that I’ve used the .save() operation instead of .insert() that’s because there is a <a href="https://github.com/bguerout/jongo/issues/134">bug in the version 0.4 of Jongo</a> which will be fixed in version 0.5.</p>
<h3 id="reading">Reading</h3>
<p>Now let’s do some reading. Just as in the mongo shell, Jongo gives you the ability to read in two ways with <em>find()</em> and <em>findOne()</em>. Let’s do some reading of our Human’s hierarchy:</p>
<pre><code class="language-java">Hero hero = heroes.findOne("{_id : {$oid: #}}", "5186a0da21622e48542ea6af").as(Hero.class);
</code></pre>
<p>In the preceding query, I know that the target _id (“5186a0da21622e48542ea6af”) belongs to a male hero (Eddard Stark). Thus I can take a full advantage of Jongo and use .as(<em>Hero</em>.class). Note, that I’ve used the $oid operator. Instead, however, I can use an <em>ObjectId</em> (org.bson.types.ObjectId):</p>
<pre><code class="language-java">Hero hero = heroes.findOne(new ObjectId("5186a0da21622e48542ea6af")).as(Hero.class);
</code></pre>
<p>Of course, when you are not sure what is the exact type of the result you can always back-off to the parent class. In our case that would be using .as(<em>Human</em>.class) instead of .as(<em>Hero</em>.class), since the <em>Human</em>.class is the parent of both <em>Hero</em> and <em>Heroine</em> classes.</p>
<p>You can query using multiple parameters:</p>
<pre><code class="language-java">Heroine heroine = heroes.findOne("{" + Human.GENDER + ": #, " + Human.FIRST_NAME + ": #}",
               Gender.FEMALE, "Arya").as(Heroine.class);
</code></pre>
<p>Did you notice how you can query using an enum and string parameters in the same way? Jongo does all the string escaping for you.</p>
<p>Now, let’s have somewhat more complex querying example. What if I want to get only one child of Eddard Stark (that is one element of the <em>children</em> array), say <a href="http://gameofthrones.wikia.com/wiki/Sansa_Stark">Sansa Stark</a>. Here is how we can do that:</p>
<pre><code class="language-java">Heroine heroine = heroes.findOne("{_id : {$oid: #}}", "5186a0da21622e48542ea6af")
       .projection("{children: {$elemMatch: {" + Human.FIRST_NAME + ": #, " +
                    Human.LAST_NAME + ": #}}}", "Sansa", "Stark")
       .map(new ResultHandler&lt;Heroine&gt;() {
            @Override
            public Heroine map(DBObject result) {
                LazyDBList o = (LazyDBList) result.get(Human.CHILDREN);
                DBObject basicDbObject = (DBObject) o.get(0);
                ObjectMapper objectMapper = new ObjectMapper();
                String content = basicDbObject.toString();
                try {
                    return objectMapper.readValue(content, Heroine.class);
                } catch (IOException e) {
                    throw new IllegalStateException("Unable to deserialize " + content);
                }
            }
        });
</code></pre>
<p>I’ve used the <em>$elemMatch</em> operator to project only the array element matching the first name and last name of Sansa Stark. In addition, I’ve took a full advantage of Jongos’s <em>ResultHandler</em> to build a custom mapping functionality.</p>
<p>Finding documents based on a regular expression is also supported. Let’s assume we have the following documents in the <em>weapons</em> collection:</p>
<pre><code class="language-json">{ "_id" : "Lightbringer" }
{ "_id" : "Longclaw", "material" : "Valyrian steel" }
{ "_id" : "Dark Sister", "material" : "Valyrian steel" }
{ "_id" : "Ice", "material" : "Valyrian steel" }
</code></pre>
<p>If you want to find all swords made of steel, you have two options. You can either use the <em>$regex</em> operator, like this:</p>
<pre><code class="language-java">weapons.find("{" + Sword.MATERIAL + ": {$regex: #}}", "steel.*").as(Sword.class)
</code></pre>
<p>… or you can go for <em>Pattern.compile(…)</em> :</p>
<pre><code class="language-java">weapons.find("{" + Sword.MATERIAL + ": #}", Pattern.compile("steel.*")).as(Sword.class)
</code></pre>
<p>Personally, I like using the # sing to keep the query logic separated from the actual data state of the query parameters. This adds to the readability of your code and makes refactoring easier.</p>
<h3 id="updating">Updating</h3>
<p>Shall we update something then? How about adding a details field to the Lightbringer document which, as you might already guessed, will hold some <em>details</em> about the <em>Lightbringer</em> sword. The details will be represented by the following <em>WeaponDetails</em> class:</p>
<pre><code class="language-java">package org.ingini.jongo.example.model.weapons;

import com.fasterxml.jackson.annotation.JsonCreator;
import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import com.fasterxml.jackson.annotation.JsonProperty;
import org.apache.commons.lang3.builder.ToStringBuilder;

@JsonIgnoreProperties(ignoreUnknown = true)
public class WeaponDetails {

    public static final String PROPHECY = "prophecy";
    public static final String CREATOR = "creator";
    private final String prophecy;
    private final String creator;

    @JsonCreator
    public WeaponDetails(  @JsonProperty(PROPHECY) String prophecy,
          @JsonProperty(CREATOR) String creator) {
        this.prophecy = prophecy;
        this.creator = creator;
    }

    @JsonProperty(PROPHECY)
    public String getProphecy() {
        return prophecy;
    }

    @JsonProperty(CREATOR)
    public String getCreator() {
        return creator;
    }

    @Override
    public String toString() {
        return new ToStringBuilder(this)
                .appendSuper(super.toString())
                .append("prophecy", prophecy)
                .append("creator", creator)
                .toString();
    }
}
</code></pre>
<p>… and here is how you do it:</p>
<pre><code class="language-java">WeaponDetails details = new WeaponDetails("The one who pulls out this sword from fire will be named Lord's Chosen ...", "Azor Ahai");

weapons.update("{_id: #}", "Lightbringer").with("{$set: {details: #}}", details);
</code></pre>
<p>Now the Lightbringer MongoDB document looks like this:</p>
<pre><code class="language-json">{ "_id" : "Lightbringer", "details" : { "prophecy" : "The one who pulls out this sword from fire will be named Lord's Chosen ...", "creator" : "Azor Ahai" } }
</code></pre>
<p>Right, everything looks fine. Or does it? I’ve updated the MongoDB document, but I haven’t change the <em>Sword</em>.java. Meaning that if I do:</p>
<pre><code class="language-java">Sword lightbringer = weapons.findOne("{_id: 'Lightbringer'}").as(Sword.class);
</code></pre>
<p>I will have the <em>lightbringer</em> sword alright but it won’t have the <em>details</em> property. Nevertheless, adding a property to a MongoDB didn’t result in some exception. This shows two things:</p>
<p>If you do forget to change your Java classes, well, you won’t be able to get what you have in the database but this won’t cause your application to crash<br>
You can implement multiple views/representations (i.e. by having multiple Java classes) over the same MongoDB document. A really nice description of what you can do with these multiple views/representations is given by <a href="http://martinfowler.com/">Martin Fowler</a> in his bliki about <a href="http://martinfowler.com/bliki/CQRS.html">Command Query Responsibility Segregation Pattern</a><br>
As for our <em>Sword</em>.java we can change it to this:</p>
<pre><code class="language-java">
package org.ingini.jongo.example.model.weapons;

import com.fasterxml.jackson.annotation.JsonCreator;
import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import com.fasterxml.jackson.annotation.JsonProperty;
import org.jongo.marshall.jackson.oid.Id;

@JsonIgnoreProperties(ignoreUnknown = true)
public class Sword {

    public static final String ID = "_id";
    public static final String MATERIAL = "material";
    public static final String DETAILS = "details";

    @Id
    private final String _id;
    private final String material;
    private final WeaponDetails details;

    @JsonCreator
    public Sword( @JsonProperty(ID) String _id,
      @JsonProperty(MATERIAL) String material,
      @JsonProperty(DETAILS) WeaponDetails details) {
        this._id = _id;
        this.material = material;
        this.details = details;
    }

    @JsonProperty(ID)
    public String getId() {
        return _id;
    }

    @JsonProperty(MATERIAL)
    public String getMaterial() {
        return material;
    }

    @JsonProperty(DETAILS)
    public WeaponDetails getDetails() {
        return details;
    }
}
</code></pre>
<p>… and now we can get all the info in the Java class.</p>
<p>Let’s see how we can tackle the problem of adding a field to a Java class and updating the MongoDB document. As I mentioned earlier, there are some non-human heroes. The most famous ones are the six orphaned dire wolf cubs found in the Wolfswood which were adopted by the children of House of Stark and the three dragons of <a href="http://gameofthrones.wikia.com/wiki/Daenerys_Targaryen">Daenerys Targaryen</a>. For the moment we will take a closer look at the dire wolves. But what’s common between the dire wolves and the dragons is that they are beasts. Thus, let’s start with the <em>Beast</em> class:</p>
<pre><code class="language-java">
package org.ingini.jongo.example.model.beasts;

import com.fasterxml.jackson.annotation.JsonProperty;
import com.fasterxml.jackson.annotation.JsonSubTypes;
import com.fasterxml.jackson.annotation.JsonTypeInfo;
import org.apache.commons.lang3.builder.EqualsBuilder;
import org.apache.commons.lang3.builder.HashCodeBuilder;
import org.apache.commons.lang3.builder.ToStringBuilder;

@JsonTypeInfo(use = JsonTypeInfo.Id.NAME, include = JsonTypeInfo.As.PROPERTY, property = Beast.KIND)
@JsonSubTypes({
        @JsonSubTypes.Type(value = DireWolf.class, name = Kind.Constants.DIRE_WOLF)
})
public abstract class Beast {

    public static final String KIND = "kind";
    public static final String NAME = "name";

    private final Kind kind;
    private final String name;

    protected Beast(Kind kind, String name) {
        this.kind = kind;
        this.name = name;
    }

    @JsonProperty(KIND)
    public Kind getKind() {
        return kind;
    }

    @JsonProperty(NAME)
    public String getName() {
        return name;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;

        Beast beast = (Beast) o;

        return new EqualsBuilder().append(this.kind, beast.kind).append(this.name, beast.name).isEquals();
    }

    @Override
    public int hashCode() {
        return new HashCodeBuilder(29, 67).append(kind).append(name).toHashCode();
    }

    @Override
    public String toString() {
        return new ToStringBuilder(this)
                .appendSuper(super.toString())
                .append("kind", kind)
                .append("name", name)
                .toString();
    }
}
</code></pre>
<p>Each beast has its kind:</p>
<pre><code class="language-java">package org.ingini.jongo.example.model.beasts;

public enum Kind {
    DIRE_WOLF(Constants.DIRE_WOLF), DRAGON(Constants.DRAGON);

    Kind(String dragon) {
    }

    public static class Constants {
        public static final String DIRE_WOLF = "DIRE_WOLF";
        public static final String DRAGON = "DRAGON";
    }
}
</code></pre>
<p>Now let’s create our <em>DireWolf</em>:</p>
<pre><code class="language-java">
package org.ingini.jongo.example.model.beasts;

import com.fasterxml.jackson.annotation.JsonCreator;
import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import com.fasterxml.jackson.annotation.JsonProperty;

@JsonIgnoreProperties(ignoreUnknown = true)
public class DireWolf extends Beast {

    @JsonCreator
    public DireWolf(@JsonProperty(NAME) String name) {
        super(Kind.DIRE_WOLF, name);
    }
}
</code></pre>
<p>So far so good, what’s left is to add a beasts property of type <em>Set&lt;? extends Beast&gt;</em> in the <em>Human</em> Java class. I’m not going to list the entire <em>Human</em>.class but you can find the code on <a href="https://github.com/ihr/jongo-by-example">GitHub</a>. Here is what I did to add a dire wolf to each of the Eddard Stark’s children:</p>
<pre><code class="language-java">Hero eddardStark = heroes.findOne(new ObjectId("5186a0da21622e48542ea6af")).as(Hero.class);
Set&lt;Human&gt; updatedChildren = // here goes some code to update each child
Hero updatedEddardStark = Hero.updateChildren(eddardStark, updatedChildren);
heroes.save(updatedEddardStark);
</code></pre>
<p>The most interesting part is the highlighted line 4. Now, make sure the updated object instance (in our case that’s <em>updatedEddardStark</em>) contains the <em>_id</em> property of the original document otherwise a new MongoDB document will be inserted. In the code above, I’ve used a <em>updateChildren</em> factory method which looks like this:</p>
<pre><code class="language-java">public static Hero updateChildren(Hero hero, Set&lt;? extends Human&gt; children) {
        return new Hero(hero.getId(), hero.getFirstName(), hero.getLastName(),
            hero.getAddress(), children, hero.getBeasts());
}
</code></pre>
<h3 id="deleting">Deleting</h3>
<p>A word of advice: reconsider several times before deleting.</p>
<p>Ok, so you’ve reached the point of saturation of your hard drive and you don’t have money for a larger one … or (which is more likely) you’ve erred something and now you have to delete it.</p>
<p>If you want to delete a single document of which you know the identifier, you can do it like this:</p>
<pre><code class="language-java">heroes.remove(new ObjectId("5186a0da21622e48542ea6af"));
</code></pre>
<p>What if you want to remove a field from a document? Well, that’s actually unset-ting it, here is how:</p>
<p>First, let’s say we have the document:</p>
<pre><code class="language-json">
{
        "_id": "5186a8a221622e48542ea6b0",
        "gender": "FEMALE",
        "first_name": "Arya",
        "last_name": "Stark",
        "address": {
            "castle": "Winterfell",
            "continent": "Westeros",
            "region": "THE_NORTH"
        }
}
</code></pre>
<p>Just to make it a bit more interesting we are going to delete the nested address field castle (highlighted on line 7) by doing the following:</p>
<pre><code class="language-java">heroes.update(new ObjectId("5186a8a221622e48542ea6b0")).with("{$unset: {" + Human.ADDRESS + "." + Address.CASTLE + ": 1}}");
</code></pre>
<h1 id="finalnote">Final note</h1>
<p>Jongo and MongoDB are really great tools to solve some of our every day problems and my only hope is that this post brought some light on how you can do that. In conclusion to everything already said, I would like to add that although Jongo is young it has a great potential of becoming a very popular tool. That’s mainly because it is easy to solve problems with it. And when I say “it is easy”, I mean that you can write more understandable / readable code and create elegant solutions avoiding unnecessary complexity.</p>
<p>If you want to learn more about Jongo then go to its home page <a href="http://jongo.org/">http://jongo.org/</a>. The documentation is great and both <a href="https://twitter.com/bguerout">Benoit</a> and <a href="https://twitter.com/amsellemyves">Yves</a> are open to discussions and new ideas, so don’t hesitate to give Jongo a try and share your opinion. If you want to learn even more - write me a comment explaining what you are interested in and I promise to write another post about Jongo and your problem.</p>
</div>
            </section>

            <section class="subscribe-form">
                <h3 class="subscribe-form-title">Subscribe to ingini</h3>
                <p>Get the latest posts delivered right to your inbox</p>
                <form method="post" action="http://127.0.0.1:2368/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"><input class="location" type="hidden" name="location"><input class="referrer" type="hidden" name="referrer">

    <div class="form-group">
        <input class="subscribe-email" type="email" name="email" placeholder="youremail@example.com">
    </div>
    <button class="" type="submit"><span>Subscribe</span></button>
    <script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>


            </section>

            <footer class="post-full-footer">

                <section class="author-card">
                        <img class="author-profile-image" src="../../../../content/images/2018/02/ivan_hristov_small.svg" alt="Ivan Hristov">
                    <section class="author-card-content">
                        <h4 class="author-card-name"><a href="../../../../author/ivan/">Ivan Hristov</a></h4>
                            <p>Read <a href="../../../../author/ivan/">more posts</a> by this author.</p>
                    </section>
                </section>
                <div class="post-full-footer-right">
                    <a class="author-card-button" href="../../../../author/ivan/">Read More</a>
                </div>

            </footer>

            <section class="post-full-comments">
                <div id="disqus_thread"></div>
                <script>
                    if (window.disqus_shortname) {
                        var disqus_config = function () {
                            this.page.url = 'http://localhost:2368/2013/04/03/mongodb-with-jongo-sleeves-up/';
                            this.page.identifier = 'ghost-13';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    }
                </script>
            </section>


        </article>

    </div>
</main>

<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
                <article class="read-next-card" style="background-image: url(../../../../content/images/2018/02/app_dev-2.svg)">
                    <header class="read-next-card-header">
                        <small class="read-next-card-header-sitetitle">— ingini —</small>
                        <h3 class="read-next-card-header-title"><a href="../../../../tag/java/">Java</a></h3>
                    </header>
                    <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"></path></svg>
</div>
                    <div class="read-next-card-content">
                        <ul>
                            <li><a href="../../../../2015/03/26/authentication-authorization-schema-design-with-mongodb/">Authentication &amp; authorization with Spring Boot &amp; MongoDB</a></li>
                            <li><a href="../../../../2014/06/17/docker-mongodb-java-yes-it-easy/">Bringing together Docker, Grunt, Maven, EmberJS &amp; MongoDB</a></li>
                            <li><a href="../../../03/17/akka-patterns-for-those-times-when-you-have-to-block/">AKKA Ask Pattern: For Those Times When You Have to Block</a></li>
                        </ul>
                    </div>
                    <footer class="read-next-card-footer">
                        <a href="../../../../tag/java/">See all 8 posts →</a>
                    </footer>
                </article>

                <article class="post-card post tag-github-pages tag-ghost-tag tag-buster tag-octopress tag-markdown tag-retext tag-blogging no-image">
    <div class="post-card-content">
        <a class="post-card-content-link" href="../../../../2014/06/01/github-pages-ghost-just-blog-it/">
            <header class="post-card-header">
                    <span class="post-card-tags">GitHub Pages</span>
                <h2 class="post-card-title">GitHub Pages &amp; Ghost - Just blog it!</h2>
            </header>
            <section class="post-card-excerpt">
                <p>A year and a half ago, I migrated my blog from WordPress to GitHub. I was very happy to have a responsive and nicely styled blog thanks to Octopress which I could host</p>
            </section>
        </a>
        <footer class="post-card-meta">
                <img class="author-profile-image" src="../../../../content/images/2018/02/ivan_hristov_small.svg" alt="Ivan Hristov">
            <span class="post-card-author"><a href="../../../../author/ivan/">Ivan Hristov</a></span>
        </footer>
    </div>
</article>

                <article class="post-card post tag-java tag-akka tag-multithreading tag-actor-model tag-concurrency no-image">
    <div class="post-card-content">
        <a class="post-card-content-link" href="../../../03/17/akka-patterns-for-those-times-when-you-have-to-block/">
            <header class="post-card-header">
                    <span class="post-card-tags">Java</span>
                <h2 class="post-card-title">AKKA Ask Pattern: For Those Times When You Have to Block</h2>
            </header>
            <section class="post-card-excerpt">
                <p>Abstract : Since you are here, chances are, you are in one of those situations where you have to come up with a blocking solution using AKKA. Thus I’m going to skip the</p>
            </section>
        </a>
        <footer class="post-card-meta">
                <img class="author-profile-image" src="../../../../content/images/2018/02/ivan_hristov_small.svg" alt="Ivan Hristov">
            <span class="post-card-author"><a href="../../../../author/ivan/">Ivan Hristov</a></span>
        </footer>
    </div>
</article>

        </div>
    </div>
</aside>

<div class="floating-header">
    <div class="floating-header-logo">
        <a href="http://localhost:2368">
                <img src="../../../../content/images/2018/02/ingini_blog_icon-3.png" alt="ingini icon">
            <span>ingini</span>
        </a>
    </div>
    <span class="floating-header-divider">—</span>
    <div class="floating-header-title">MongoDB With Jongo - Sleeves Up!</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"></path>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=MongoDB%20With%20Jongo%20-%20Sleeves%20Up!&amp;url=http://localhost:2368/2013/04/03/mongodb-with-jongo-sleeves-up/" onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"></path></svg>
        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:2368/2013/04/03/mongodb-with-jongo-sleeves-up/" onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"></path></svg>
        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>




        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="http://localhost:2368">ingini</a> © 2018</section>
                <nav class="site-footer-nav">
                    <a href="http://localhost:2368">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <div id="subscribe" class="subscribe-overlay">
        <a class="subscribe-overlay-close" href="index.html#"></a>
        <div class="subscribe-overlay-content">
            <h1 class="subscribe-overlay-title">Subscribe to ingini</h1>
            <p class="subscribe-overlay-description">Stay up to date! Get all the latest &amp; greatest posts delivered straight to your inbox</p>
            <form method="post" action="http://127.0.0.1:2368/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"><input class="location" type="hidden" name="location"><input class="referrer" type="hidden" name="referrer">

    <div class="form-group">
        <input class="subscribe-email" type="email" name="email" placeholder="youremail@example.com">
    </div>
    <button class="" type="submit"><span>Subscribe</span></button>
    <script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>


        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="../../../../assets/js/jquery.fitvids.js?v=1e82d01aa7"></script>

    <script>
        if (window.social_link) {
            var url_regexp = /^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/
            $.each(window.social_link, function(type, url) {
                if (typeof url === "string" && url_regexp.test(url)) {
                    $('<a>', {
                        class: 'social-link social-link-'+type,
                        href: url,
                        target: '_blank'
                    }).appendTo('.social-links');
                    var builtin_type = ['500px', 'facebook', 'flickr', 'github', 'gmail', 'googleplus', 'instagram', 'line', 'linkedin', 'messenger', 'microsoftoutlook', 'plurk', 'sinaweibo', 'skype', 'snapchat', 'stackoverflow', 'telegram', 'twitter', 'wechat', 'whatsapp'];
                    var icon_path = '/assets/icons/type.svg?v=1e82d01aa7'
                    if (builtin_type.indexOf(type) > -1) {
                        icon_path = icon_path.replace('type', type);
                    } else if (type.endsWith('-local')) {
                        icon_path = icon_path.replace('type', type.substring(0, type.length-6));
                    } else {
                        icon_path = 'https://simpleicons.org/icons/'+type+'.svg';
                    }
                    $('.social-link-'+type).load(icon_path);
                }
            });
        }
    </script>

    <script>
        if (window.ga_id) {
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
            ga('create', window.ga_id, 'auto');
            ga('require', 'linkid', 'linkid.js');
            ga('send', 'pageview');
        }
    </script>

    <script type="text/javascript" src="../../../../assets/js/prism.js?v=1e82d01aa7"></script>


    <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>


    <!-- You can safely delete this line if your theme does not require jQuery -->
<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

</body>
