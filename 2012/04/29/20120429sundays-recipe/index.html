<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />

	<title>JPA 2.0, Hibernate, HSQLDB, and Google Guice</title>
	<meta name="description" content="" />

	<meta name="HandheldFriendly" content="True" />
	<meta name="MobileOptimized" content="320" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<link rel="alternate" type="application/rss+xml" href="http://ingini.org/rss/">
	<link rel="shortcut icon" href="../../../../favicon.ico">
	<link rel="prefetch" href="http://ingini.org">

	<link rel="stylesheet" type="text/css" href="../../../../assets/css/theme.min.css?v=1b13a5c811" />
	<link href='http://fonts.googleapis.com/css?family=Domine:700|Open+Sans:400,600|Source+Code+Pro:500' rel='stylesheet' type='text/css'>
	<link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

	<link rel="canonical" href="http://ingini.org/2012/04/29/20120429sundays-recipe/" />
    
    <meta property="og:site_name" content="Ingini" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="JPA 2.0, Hibernate, HSQLDB, and Google Guice" />
    <meta property="og:description" content="Today&#x27;s software recipe includes the following main ingredients (as Maven artifacts) Guice, Hibernate, JPA, HSQLDB, FEST-Assert, Apache Commons Lang, JUnit which we are going to put and mix in Eclipse 3.7.2 pot. Our goal would be a simple..." />
    <meta property="og:url" content="http://ingini.org/2012/04/29/20120429sundays-recipe/" />
    <meta property="article:published_time" content="2012-04-29T11:59:00.000Z" />
    <meta property="article:modified_time" content="2014-05-28T13:41:45.709Z" />
    <meta property="article:tag" content="JPA 2.0" />
    <meta property="article:tag" content="Maven" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="JPA 2.0, Hibernate, HSQLDB, and Google Guice" />
    <meta name="twitter:description" content="Today&#x27;s software recipe includes the following main ingredients (as Maven artifacts) Guice, Hibernate, JPA, HSQLDB, FEST-Assert, Apache Commons Lang, JUnit which we are going to put and mix in Eclipse 3.7.2 pot. Our goal would be a simple..." />
    <meta name="twitter:url" content="http://ingini.org/2012/04/29/20120429sundays-recipe/" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Ingini",
    "author": {
        "@type": "Person",
        "name": "Ivan Hristov",
        "image": "http://ingini.org/content/images/2014/Jun/wolf_small.jpg",
        "url": "http://ingini.org/author/ivan-hristov",
        "sameAs": "http://ingini.org"
    },
    "headline": "JPA 2.0, Hibernate, HSQLDB, and Google Guice",
    "url": "http://ingini.org/2012/04/29/20120429sundays-recipe/",
    "datePublished": "2012-04-29T11:59:00.000Z",
    "dateModified": "2014-05-28T13:41:45.709Z",
    "keywords": "JPA 2.0, Maven",
    "description": "Today&#x27;s software recipe includes the following main ingredients (as Maven artifacts) Guice, Hibernate, JPA, HSQLDB, FEST-Assert, Apache Commons Lang, JUnit which we are going to put and mix in Eclipse 3.7.2 pot. Our goal would be a simple..."
}
    </script>

    <meta name="generator" content="Ghost 0.5" />
    <link rel="alternate" type="application/rss+xml" title="Ingini" href="http://ingini.org/rss/" />
</head>
<body class="post-template tag-jpa-2-0 tag-maven blogcover">

	<header class="title">
		<a href="http://ingini.org"><i class="fa fa-bookmark-o fa-lg"></i><span>Ingini</span></a>
	</header>

	<nav class="mainnav post tag-jpa-2-0 tag-maven">
		<a id="top"></a>
<div class="navwrap">
	<ul class="menu">
			<li class="nav-home" role="presentation"><a href="http://ingini.org/">Home</a></li>
	</ul>
	<div class="toggle"><a href="index.html#"><i class="fa fa-bars"></i></a></div>
</div>
	</nav>

	

<div class="index">
	<div class="wrapper">
		<h1 class="right">JPA 2.0, Hibernate, HSQLDB, and Google Guice</h1>
		<h2 class="left">Introduction</h2>
	</div>
</div>

<div class="profile post tag-jpa-2-0 tag-maven">
	<img src="../../../../content/images/2014/Jun/wolf_small.jpg" class="profileimage" alt="user">
	<h4>Ivan Hristov</h4>
	
	        <ul class="socialside">
	            <li><a href="https://twitter.com/iv_hristov" class="smallsocialbutton twitter" target="_blank"><i class="fa fa-twitter"></i></a></li>
	            <!--<li><a href="http://facebook.com" class="smallsocialbutton facebook" target="_blank"><i class="fa fa-facebook"></i></a></li>-->
	            <li><a href="https://github.com/ihr" class="smallsocialbutton github" target="_blank"><i class="fa fa-github"></i></a></li>
	            <!--<li><a href="htt://instagram.com/" class="smallsocialbutton instagram" target="_blank"><i class="fa fa-instagram"></i></a></li>-->
	            <li><a href="http://ingini.org/rss/" class="smallsocialbutton rss" target="_blank"><i class="fa fa-rss"></i></a></li>
	        </ul>
	
	
	<p></p>
	<hr>
</div>

<div id="cover" class="cover post tag-jpa-2-0 tag-maven">
	<div class="background" ></div>
	<header class="wrapper">
		<h2>
				<a href="../../../../tag/jpa-2-0/index.html">JPA 2.0</a> 
				<a href="../../../../tag/maven/index.html">Maven</a> 
		</h2>
		<h1><a href="index.html#">JPA 2.0, Hibernate, HSQLDB, and Google Guice</a></h1>
		<span>
			Posted by <a href="../../../../author/ivan-hristov/index.html">Ivan Hristov</a>
				on <i class="fa fa-clock-o"></i> <time datetime="2012-04-29">April 29th, 2012</time>.
		</span>
	</header>
	<i class="fa fa-chevron-down movedown"></i>
</div>

<section class="posts wrapper">
	<article class="post post tag-jpa-2-0 tag-maven">
		<header>
			<div class="feature"><span>Featured</span><i class="fa fa-bookmark fa-lg"></i></div>
			<h2>
					<a href="../../../../tag/jpa-2-0/index.html">JPA 2.0</a> 
					<a href="../../../../tag/maven/index.html">Maven</a> 
			</h2>
			<h1 id="posttitle"><a href="index.html#">JPA 2.0, Hibernate, HSQLDB, and Google Guice</a></h1>
			<span>
				Posted by <a href="../../../../author/ivan-hristov/index.html">Ivan Hristov</a>
				on <i class="fa fa-clock-o"></i> <time datetime="2012-04-29">April 29th, 2012</time>.
			</span>
		</header>
		<section class="postbody">
			<p>Today's software recipe includes the following main ingredients (as <a href="http://maven.apache.org/">Maven</a> artifacts) <a href="http://code.google.com/p/google-guice/">Guice</a>, <a href="http://www.hibernate.org/">Hibernate</a>, <a href="http://docs.oracle.com/javaee/6/tutorial/doc/bnbpy.html">JPA</a>, <a href="http://hsqldb.org/">HSQLDB</a>, <a href="http://fest.easytesting.org/">FEST-Assert</a>, <a href="http://commons.apache.org/lang/">Apache Commons Lang</a>, <a href="http://www.junit.org/">JUnit</a> which we are going to put and mix in <a href="http://www.eclipse.org/">Eclipse</a> 3.7.2 pot. Our goal would be a simple one: persist something in HSQLDB using JPA and Hibernate as underlying implementation; take advantage of Guice for <strong>C</strong>ontext and <strong>D</strong>ependency <strong>I</strong>njection (CDI) and test what we've done with JUnit, FEST-Assert and HSQLDB Manager. For a start here is the <em>pom.xml</em> relevant portion which you may want to include:</p>

<!-- more -->

<pre><code class=" xml">&lt;dependencies&gt;  
 &lt;dependency&gt;
  &lt;groupId&gt;com.google.inject&lt;/groupId&gt;
  &lt;artifactId&gt;guice&lt;/artifactId&gt;
  &lt;version&gt;3.0&lt;/version&gt;
 &lt;/dependency&gt;
 &lt;dependency&gt;
  &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
  &lt;artifactId&gt;hibernate-entitymanager&lt;/artifactId&gt;
  &lt;version&gt;4.1.1.Final&lt;/version&gt;
 &lt;/dependency&gt;
 &lt;dependency&gt;
  &lt;groupId&gt;org.hibernate.javax.persistence&lt;/groupId&gt;
  &lt;artifactId&gt;hibernate-jpa-2.0-api&lt;/artifactId&gt;
  &lt;version&gt;1.0.1.Final&lt;/version&gt;
 &lt;/dependency&gt;
 &lt;dependency&gt;
  &lt;groupId&gt;org.hsqldb&lt;/groupId&gt;
  &lt;artifactId&gt;hsqldb&lt;/artifactId&gt;
  &lt;version&gt;2.2.8&lt;/version&gt;
 &lt;/dependency&gt;
 &lt;dependency&gt;
  &lt;groupId&gt;commons-lang&lt;/groupId&gt;
  &lt;artifactId&gt;commons-lang&lt;/artifactId&gt;
  &lt;version&gt;2.6&lt;/version&gt;
 &lt;/dependency&gt;
 &lt;dependency&gt;
  &lt;groupId&gt;junit&lt;/groupId&gt;
  &lt;artifactId&gt;junit&lt;/artifactId&gt;
  &lt;version&gt;4.10&lt;/version&gt;
  &lt;scope&gt;test&lt;/scope&gt;
 &lt;/dependency&gt;
 &lt;dependency&gt;
  &lt;groupId&gt;org.easytesting&lt;/groupId&gt;
  &lt;artifactId&gt;fest-assert&lt;/artifactId&gt;
  &lt;version&gt;1.4&lt;/version&gt;
  &lt;scope&gt;test&lt;/scope&gt;
 &lt;/dependency&gt;
&lt;/dependencies&gt;  
</code></pre>

<p>Since we need something to persist in our database let's create a very simple <em>Project</em> entity having only an identifier and a name fields. Here is how it looks like:</p>

<pre><code class=" java">package org.honeysoft.hsqldbtest.entity;

import javax.persistence.Column;  
import javax.persistence.Entity;  
import javax.persistence.GeneratedValue;  
import javax.persistence.Id;  
import javax.persistence.NamedQuery;  
import org.apache.commons.lang.builder.EqualsBuilder;

@Entity(name = "project")
public class Project {

    @Id
    @GeneratedValue
    private Long id;

    @Column(name="name")
    private String name;

    public Project() {
    // JPA needs empty constructor
    }

    public Project(String projectName) {
    this.name = projectName;
    }

    public Long getId() {
    return id;
    }

    public void setId(Long id) {
    this.id = id;
    }

    public String getName() {
    return name;
    }

    public void setName(String name) {
    this.name = name;
    }
    @Override
    public boolean equals(Object obj) {
    if (obj == this) {
        return true;
    }

    if (!(obj instanceof Project)) {
        return false;
    }
    Project theOtherObject = (Project) obj;
    EqualsBuilder equalsBuilder = new EqualsBuilder();
    equalsBuilder.append(theOtherObject.name, this.name);

    return equalsBuilder.isEquals();
    }
}
</code></pre>

<p>Next we need a <strong>d</strong>ata <strong>a</strong>ccess <strong>o</strong>bjet (DAO) :</p>

<pre><code class=" java">package org.honeysoft.hsqldbtest.dao;

import org.honeysoft.hsqldbtest.entity.Project;

public interface IProjectDao {  
    void save(Project project);
}
</code></pre>

<p>... and its implementation (which we are going to keep short and simple):</p>

<pre><code class=" java">package org.honeysoft.hsqldbtest.service.impl;

import javax.inject.Inject;  
import javax.persistence.EntityManager;

import org.honeysoft.hsqldbtest.dao.IProjectDao;  
import org.honeysoft.hsqldbtest.entity.Project;

public class ProjectDao implements IProjectDao {

    @Inject
    private EntityManager entityManager;

    @Override
    public void save(Project project) {
    entityManager.getTransaction().begin();
    entityManager.persist(project);
    entityManager.getTransaction().commit();
    }
}
</code></pre>

<p>Here comes our service which will do the business logic:</p>

<pre><code class=" java">package org.honeysoft.hsqldbtest.service;

public interface IProjectService {  
    void create(String projectName);
}
</code></pre>

<p>... and its implementation:</p>

<pre><code class=" java">package org.honeysoft.hsqldbtest.service.impl;

import javax.inject.Inject;

import org.honeysoft.hsqldbtest.dao.IProjectDao;  
import org.honeysoft.hsqldbtest.entity.Project;  
import org.honeysoft.hsqldbtest.service.IProjectService;

public class ProjectService implements IProjectService {

    @Inject
    private IProjectDao projectDao;

    /** @{inheritDocs */
    @Override
    public void create(String projectName) {
    projectDao.save(new Project(projectName));
    }
}
</code></pre>

<p>So far so good. We do need some plumbing though. Within the scope of our small recipe we have two dimensions of plumbing we have to consider. One of them is the CDI and since we use Guice in our example we have to create a module keeping the dependency bindings, here it goes:</p>

<pre><code class=" java">package org.honeysoft.hsqldbtest;

import javax.inject.Singleton;  
import javax.persistence.EntityManager;  
import javax.persistence.EntityManagerFactory;  
import javax.persistence.Persistence;

import org.honeysoft.hsqldbtest.dao.IProjectDao;  
import org.honeysoft.hsqldbtest.dao.impl.ProjectDao;  
import org.honeysoft.hsqldbtest.service.IProjectService;  
import org.honeysoft.hsqldbtest.service.impl.ProjectService;

import com.google.inject.AbstractModule;  
import com.google.inject.Provides;

public class DBModule extends AbstractModule {

    private static final ThreadLocal&lt;EntityManager&gt; ENTITY_MANAGER_CACHE = new ThreadLocal&lt;EntityManager&gt;();

    @Override
    public void configure() {
    bind(IProjectDao.class).to(ProjectDao.class);
    bind(IProjectService.class).to(ProjectService.class);
    }

    @Provides
    @Singleton
    public EntityManagerFactory createEntityManagerFactory() {
    return Persistence.createEntityManagerFactory("db-manager");
    }

    @Provides
    public EntityManager createEntityManager(
        EntityManagerFactory entityManagerFactory) {
    EntityManager entityManager = ENTITY_MANAGER_CACHE.get();
    if (entityManager == null) {
        ENTITY_MANAGER_CACHE.set(entityManager = entityManagerFactory
            .createEntityManager());
    }
    return entityManager;
    }
}
</code></pre>

<p>The second aspect of our concerns is the JPA. In order for JPA to be glued with its implementation (in our case Hibernate), we need a <em>persistence.xml</em> file located within <em>META-INF</em> directory in the classpath of our Java application. Since we use Maven, I'm going to put the <em>persistence.xml</em> file in <em>src/main/resources/META-INF/persistence.xml</em>. The actual content of the file is:</p>

{% codeblock lang:xml mark:7,12 %}
<?xml version="1.0" encoding="UTF-8"?>  

<p><persistence xmlns="http://java.sun.com/xml/ns/persistence" <br />
    xmlns:xsi="<a href='http://www.w3.org/2001/XMLSchema-instance'>http://www.w3.org/2001/XMLSchema-instance</a>"
    xsi:schemaLocation="<a href='http://java.sun.com/xml/ns/persistence'>http://java.sun.com/xml/ns/persistence</a> <a href='http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd'>http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd</a>"
    version="1.0"></p>

<pre><code>&lt;persistence-unit name="db-manager" transaction-type="RESOURCE_LOCAL"&gt;
    &lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;

    &lt;properties&gt;
        &lt;property name="javax.persistence.jdbc.driver" value="org.hsqldb.jdbcDriver" /&gt;
        &lt;property name="javax.persistence.jdbc.url" value="jdbc:hsqldb:hsql://localhost/tmp/testdb" /&gt;
        &lt;property name="javax.persistence.jdbc.user" value="sa" /&gt;
        &lt;property name="javax.persistence.jdbc.password" value="" /&gt;
        &lt;!-- if this is true, hibernate will print (to stdout) the SQL it executes, 
            so you can check it to ensure it's not doing anything crazy --&gt;

        &lt;property name="hibernate.show_sql" value="true" /&gt;
        &lt;!-- since most database servers have slightly different versions of the 
            SQL, Hibernate needs you to choose a dialect so it knows the subtleties of 
            talking to that server --&gt;
        &lt;property name="hibernate.dialect" value="org.hibernate.dialect.HSQLDialect" /&gt;
        &lt;!-- this tell Hibernate to update the DDL when it starts, very useful 
            for development, dangerous in production --&gt;
        &lt;property name="hibernate.hbm2ddl.auto" value="update" /&gt;
    &lt;/properties&gt;
&lt;/persistence-unit&gt;
</code></pre>

<p></persistence> <br />
{% endcodeblock %}</p>

<p>Here are some important stuff:</p>

<ol>
<li><p>On line 7 we use the <em>db-manager</em> which is the same as in our <em>DBModule.createEntityManagerFactory()</em></p></li>
<li><p>On line 12, we've specified the URL of our database : <em>jdbc:hsqldb:hsql://localhost/tmp/testdb</em> which is important since we have to actually have a HSQLDB running. I've used an Eclipse launcher to run HSQLDB with the following program arguments: <em>--database.0 file:/tmp/testdb --dbname.0 testdb</em>. In case you don't know how to create such an Eclipse launcher you can follow this <a href="http://objectgeneration.com/eclipse/11-Database.html">link</a></p></li>
</ol>

<p>And last but not least our test:</p>

<pre><code class=" java">package org.honeysoft.hsqldbtest.service.impl;

import static org.fest.assertions.Assertions.assertThat;

import java.util.List;

import javax.persistence.EntityManager;

import org.honeysoft.hsqldbtest.DBModule;  
import org.honeysoft.hsqldbtest.entity.Project;  
import org.honeysoft.hsqldbtest.service.IProjectService;  
import org.junit.Test;

import com.google.inject.Guice;  
import com.google.inject.Injector;

public class TestProjectService {

    @Test
    public void shouldPersistProject() throws Exception {
    // GIVEN
    Injector injector = Guice.createInjector(new DBModule());
    IProjectService projectService = injector
        .getInstance(IProjectService.class);
    EntityManager entityManager = injector.getInstance(EntityManager.class);

    String projectName = "honeysoft";

    // WHEN
    projectService.create(projectName);

    // THEN
    List&lt;Project&gt; resultList = entityManager.createNamedQuery(
        Project.GET_ALL, Project.class).getResultList();

    assertThat(resultList.contains(new Project(projectName))).isTrue();
    }
}
</code></pre>

<p>Well, more or less that's it. If you want you can take advantage of HSQLDB Database Manager. One way to run it is via Eclipse launcher. You don't need any other dependency within you project in order to run it (except for <em>hsqldb</em>). Create a new Java Application Eclipse launcher where as a <em>Project</em> you choose the one which have the <em>hsqldb</em> as a Maven dependency and in <em>Main class</em> you provide <em>org.hsqldb.util.DatabaseManagerSwing</em>.</p>

<p>Acknowledgements goes to these guys for their work and to the open-source community without which this post would not take place:</p>

<ul>
<li><p><a href="http://uaihebert.com/?p=57">JUnit with HSQLDB, JPA and Hibernate</a></p></li>
<li><p><a href="http://www.benmccann.com/dev-blog/hibernate-with-jpa-annotations-and-guice/">Hibernate with JPA Annotations and Guice</a></p></li>
<li><p><a href="http://www.alexecollins.com/?q=content/tutorial-hibernate-jpa-part-1">Tutorial: Hibernate, JPA - Part 1</a></p></li>
</ul>
		</section>
		<footer>
			<ul class="share left">
				<li><a href="http://twitter.com/share?text=JPA%202.0%2C%20Hibernate%2C%20HSQLDB%2C%20and%20Google%20Guice&url=http://ingini.org/2012/04/29/20120429sundays-recipe/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" class="smallbutton lightgray"><i class="fa fa-twitter"></i>Twitter</a></li>
				<li><a href="https://www.facebook.com/sharer/sharer.php?u=http://ingini.org/2012/04/29/20120429sundays-recipe/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" class="smallbutton lightgray"><i class="fa fa-facebook"></i>Facebook</a></li>
			</ul>
			<ul class="tags right">
				<a href="../../../../tag/jpa-2-0/index.html" class="smallbutton solidgray">JPA 2.0</a>
				<a href="../../../../tag/maven/index.html" class="smallbutton solidgray">Maven</a>
			</ul>
		</footer>
		<div class="postprofile">
			<img src="../../../../content/images/2014/Jun/wolf_small.jpg" class="author" alt="user">
			<div class="info">
				<h4>Ivan Hristov</h4>
				<a href="http://ingini.org">http://ingini.org</a>
				<p></p>
				
				        <ul class="social">
				            <li><a href="https://twitter.com/iv_hristov" class="twitter" target="_blank"><i class="fa fa-twitter"></i></a></li>
				            <!--<li><a href="http://facebook.com/" class="facebook" target="_blank"><i class="fa fa-facebook"></i></a></li>-->
				            <li><a href="https://github.com/ihr" class="github" target="_blank"><i class="fa fa-github-alt"></i></a></li>
				            <!--<li><a href="http://youtube.com/" class="youtube" target="_blank"><i class="fa fa-youtube"></i></a></li>-->
				            <!--<li><a href="http://dribbble.com/" class="dribbble" target="_blank"><i class="fa fa-dribbble"></i></a></li>-->
				            <li><a href="http://plus.google.com/" class="googleplus" target="_blank"><i class="fa fa-google-plus"></i></a></li>
				            <!--<li><a href="http://instagram.com/" class="instagram" target="_blank"><i class="fa fa-instagram"></i></a></li>-->
				            <!--<li><a href="http://pinterest.com/" class="pinterest" target="_blank"><i class="fa fa-pinterest"></i></a></li>-->
				            <li><a href="http://ch.linkedin.com/in/ivhristov" class="linkedin" target="_blank"><i class="fa fa-linkedin"></i></a></li>
				            <li><a href="http://ingini.org/rss/" class="rss" target="_blank"><i class="fa fa-rss"></i></a></li>
				        </ul>
				
				
			</div>
		</div>
		<div class="comments">
			<a href="javascript:;" class="readmore smallbutton blue"><i class="fa fa-comments"></i>View Comments...</a>
			<div id="disqus_thread"></div>
			<div id="g-comments"></div>
		</div>

	</article>

</section>



	<footer class="wrapper">
		<div class="inlinemenu">
			<div class="graybar">
				<div class="left"><i class="fa fa-bars"></i>Navigation</div>
				<div class="right"><i class="fa fa-chevron-down"></i></div>
			</div>
			<ul class="menu">
				<a id="top"></a>
				<div class="navwrap">
					<ul class="menu">
					</ul>
					<div class="toggle"><a href="index.html#"><i class="fa fa-bars"></i></a></div>
				</div>			</ul>
		</div>
		<div>
			Copyright &copy; <a href="http://ingini.org/">Ingini</a>. 2015 &bull; All rights reserved.
			<span class="ghost">Proudly published with <a href="http://ghost.org" target="_blank">Ghost</a>.</span>
		</div>
	</footer>
	
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script async type="text/javascript" src="../../../../assets/js/theme.min.js?v=1b13a5c811"></script>

</body>
</html>
